<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="card-sync.css">
    <link rel="stylesheet" href="shared-optimizations.css?v=1.0">
    <title>Smart Locker - Sinkron Kartu RFID</title>
</head>

<body>
    <!-- Animated Background -->
    <div class="particles-bg">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <div class="page-container">
        <!-- Header -->
        <header class="page-header">
            <button class="back-btn" onclick="window.location.href='profile.html'">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1 class="page-title">
                <i class="fas fa-id-card"></i>
                Sinkron Kartu RFID
            </h1>
        </header>

        <!-- Current Card Status -->
        <div class="card-status-section" id="currentCardSection">
            <div class="status-header">
                <h2><i class="fas fa-credit-card"></i> Status Kartu Anda</h2>
            </div>
            <div class="current-card" id="currentCard">
                <div class="card-visual">
                    <div class="card-chip"></div>
                    <div class="card-wave">
                        <i class="fas fa-wifi"></i>
                    </div>
                    <div class="card-number" id="cardNumber">BELUM TERDAFTAR</div>
                    <div class="card-label">Smart Locker Card</div>
                </div>
                <div class="card-info-text">
                    <span class="status-badge not-registered" id="cardStatusBadge">
                        <i class="fas fa-times-circle"></i>
                        Belum Terdaftar
                    </span>
                    <p id="cardMessage">Anda belum mendaftarkan kartu RFID</p>
                </div>
            </div>
        </div>

        <!-- Sync Section -->
        <div class="sync-section">
            <div class="sync-header">
                <h2><i class="fas fa-sync-alt"></i> Daftarkan Kartu Baru</h2>
                <p>Ikuti langkah berikut untuk mendaftarkan kartu RFID Anda</p>
            </div>

            <!-- Steps -->
            <div class="sync-steps">
                <div class="step" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Mulai</h3>
                        <p>Klik tombol mulai untuk mendapatkan Kode OTP.</p>
                    </div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Tempel Kartu</h3>
                        <p>Tempelkan kartu RFID Anda pada reader.</p>
                    </div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Input OTP</h3>
                        <p>Masukkan kode OTP pada keypad loker.</p>
                    </div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>Selesai</h3>
                        <p>Kartu berhasil terdaftar.</p>
                    </div>
                </div>
            </div>

            <!-- OTP Display Area (Initially Hidden) -->
            <div class="otp-display-container" id="otpContainer" style="display: none;">
                <p class="otp-instruction">Masukkan kode ini di keypad setelah menempel kartu:</p>
                <div class="otp-code" id="otpCode">------</div>
            </div>

            <!-- RFID Reader Animation -->
            <div class="rfid-reader" id="rfidReader">
                <div class="reader-visual">
                    <div class="reader-ring ring1"></div>
                    <div class="reader-ring ring2"></div>
                    <div class="reader-ring ring3"></div>
                    <div class="reader-icon">
                        <i class="fas fa-wifi"></i>
                    </div>
                </div>
                <div class="reader-status" id="readerStatus">
                    <span class="status-text">Siap untuk sinkronisasi</span>
                </div>
                <div class="countdown" id="countdown" style="display: none;">
                    <span class="countdown-number" id="countdownNumber">30</span>
                    <span class="countdown-text">detik tersisa</span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="sync-btn" id="syncBtn" onclick="startSync()">
                    <i class="fas fa-play"></i>
                    <span>Mulai Sinkronisasi</span>
                </button>
                <button class="cancel-btn" id="cancelBtn" onclick="cancelSync()" style="display: none;">
                    <i class="fas fa-times"></i>
                    <span>Batalkan</span>
                </button>
            </div>
        </div>

        <!-- Reset Card Section -->
        <div class="reset-section">
            <div class="reset-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Kartu Hilang?</h2>
                <p>Reset kartu lama dan daftarkan kartu baru atau dapatkan PIN sementara</p>
            </div>
            <div class="reset-options">
                <button class="reset-option-btn" onclick="window.location.href='reset-card.html'">
                    <div class="option-icon">
                        <i class="fas fa-redo"></i>
                    </div>
                    <div class="option-text">
                        <h4>Reset Kartu</h4>
                        <p>Hapus kartu lama via OTP email</p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button class="reset-option-btn" onclick="window.location.href='get-pin.html'">
                    <div class="option-icon pin">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="option-text">
                        <h4>Dapatkan PIN</h4>
                        <p>Buka loker dengan PIN sementara</p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal (placed outside page-container for proper fixed positioning) -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content success">
            <div class="modal-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>Kartu Berhasil Didaftarkan!</h3>
            <p>Kartu RFID Anda sudah terhubung dan siap digunakan</p>
            <div class="card-uid-display" id="newCardUid">
                UID: XXXX-XXXX-XXXX
            </div>
            <button class="modal-btn" onclick="closeModal()">
                <i class="fas fa-check"></i> Selesai
            </button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="theme.js"></script>
    <script src="card-sync.js"></script>
</body>

</html>